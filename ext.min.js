var $counter=document.getElementById("counter"),$comments=document.getElementById("comments"),$asker=document.getElementById("asker"),$webhook_destination=document.getElementById("webhook_destination");document.getElementById("inc1").addEventListener("click",inc1);document.getElementById("inc2").addEventListener("click",inc2);document.getElementById("inc5").addEventListener("click",inc5);document.getElementById("inc10").addEventListener("click",inc10);
document.getElementById("dec").addEventListener("click",dec);document.getElementById("dl").addEventListener("click",dl);document.getElementById("clear").addEventListener("click",clear);document.getElementById("savecomments").addEventListener("click",save_comments);document.getElementById("ul").addEventListener("click",sendHook);document.getElementById("menu").addEventListener("click",toggleMenu);document.getElementById("save_zap").addEventListener("click",save_webhook_destination);
window.addEventListener("load",render);function inc1(){chrome.storage.sync.get("counter",function(a){"counter"in a?set(a.counter+1):set(1)});incdone()}function inc2(){chrome.storage.sync.get("counter",function(a){"counter"in a?set(a.counter+2):set(1)});incdone()}function inc5(){chrome.storage.sync.get("counter",function(a){"counter"in a?set(a.counter+5):set(1)});incdone()}function inc10(){chrome.storage.sync.get("counter",function(a){"counter"in a?set(a.counter+10):set(1)});incdone()}
function incdone(){var a="Another one!;There we go!;Hurray!;One more!;Yee-haw;Bring em on!;Crazy talk!;MOAR;Hold the phone!;Da-yum!;Ludicrous;Are you crazy?".split(";");showAlert(a[Math.floor(Math.random()*a.length)],"alert-smurf")}function dec(){chrome.storage.sync.get("counter",function(a){"counter"in a?set(a.counter-1):set(1)})}function add(a){chrome.storage.sync.get("counter",function(b){"counter"in b?set(b.counter+a):set(1)})}
function clear(){try{set(0),clear_comments(),showAlert("[SUCCESS] All clear","alert-smurf")}catch(a){showAlert("[FAILED] Uh oh. Something went wrong."+a,"alert-smurf")}}function set(a){0>a?a=0:999<a&&(a=999);chrome.storage.sync.set({counter:a},function(){render()})}
function render(){chrome.storage.sync.get("counter",function(a){$counter.innerText="counter"in a?a.counter:0;0!=$counter.innerText?(chrome.browserAction.setBadgeText({text:$counter.innerText}),chrome.browserAction.setBadgeBackgroundColor({color:"red"})):(chrome.browserAction.setBadgeText({text:"0"}),chrome.browserAction.setBadgeBackgroundColor({color:"green"}))});chrome.storage.sync.get("comments",function(a){$comments.value="comments"in a?a.comments:""});chrome.storage.sync.get("asker",function(a){$asker.value=
"asker"in a?a.asker:""});chrome.storage.sync.get("webhook_destination",function(a){$webhook_destination.value="webhook_destination"in a?a.webhook_destination:""});""===$webhook_destination&&(document.getElementById("ul").disabled=!0)}function save_comments(){try{chrome.storage.sync.set({comments:$comments.value}),chrome.storage.sync.set({asker:$asker.value}),showAlert("[SUCCESS] Saved comments","alert-smurf")}catch(a){showAlert("[SUCCESS] Uh oh. Something went wrong"+a,"alert-smurf")}}
function clear_comments(){chrome.storage.sync.set({comments:""});chrome.storage.sync.set({asker:""})}function save_webhook_destination(){try{chrome.storage.sync.set({webhook_destination:$webhook_destination.value}),showAlert("[SUCCESS] Saved webhook destination.","alert-smurf")}catch(a){showAlert("[FAILED] Uh oh. Something went wrong."+a,"alert-smurf")}}
function content_for_dl(a){var b,c=getDateFormatted();"csv"==a?b="date,count,asker,comments\n"+(c+","+$counter.innerText+","+$asker.value+","+$comments.value):"json"==a&&(b=JSON.stringify({date:c,count:$counter.innerText,asker:$asker.value,comments:$comments.value}));return b}
function dl(){try{var a=content_for_dl("csv"),b=document.createElement("a");b.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(a));b.setAttribute("download","qTrack_export.csv");b.style.display="none";document.body.appendChild(b);b.click();document.body.removeChild(b);showAlert("[SUCCESS] File ready for download.","alert-smurf")}catch(c){showAlert("[FAILED] Could not download file."+c,"alert-smurf")}}
function sendHook(){save_comments();var a=content_for_dl("json");console.log(a);if(""==$webhook_destination.value)showAlert("[FAILED] No webhook destination set.","alert-smurf");else{var b=new XMLHttpRequest;b.open("POST",$webhook_destination.value);b.onreadystatechange=function(){4===b.readyState&&(console.log(b.responseText),200===b.status?(showAlert("[SUCCESS] Synced to "+$webhook_destination.value,"alert-smurf"),clear()):showAlert("[FAILED] Something went wrong. Check your webhook destination.",
"alert-smurf"))};b.send(a)}}function toggleMenu(){var a=document.getElementById("menu-hidden");a.style.display="none"===a.style.display?"block":"none"}function showAlert(a,b){var c=document.getElementsByClassName("footer")[0],d=document.createElement("div");d.classList.add("alert");d.innerText=getTimeFormatted()+" "+a;c.appendChild(d);c.scrollTop=c.scrollHeight}
function getDateFormatted(){var a=new Date,b=a.getDate(),c=a.getMonth()+1;a=a.getFullYear();10>b&&(b="0"+b);10>c&&(c="0"+c);return a+"-"+c+"-"+b}function getTimeFormatted(){var a=new Date,b=a.getHours();a=a.getMinutes();10>a&&(a="0"+a);10>b&&(b="0"+b);return b+":"+a}chrome.commands.onCommand.addListener(function(a){"sync"===a&&sendHook()});
